general ops and security notes

XXX subscribe to bugtraq asterisk feed
XXX logwatch
XXX backups!
    make tarballs and ssh them somewhere in a cron?
    rsync?
    what directories need to be kept?

* setup firewall
# assumes that we turned iptables off before, if it matters
# XXX should do this earlier
# XXX will need more ports for iax2 later - asterisk to asterisk

service add iptables

chkconfig --add iptables

edit /etc/sysconfig/iptables:

*filter
:INPUT DROP [4:524]
:FORWARD DROP [0:0]
:OUTPUT ACCEPT [1547:458027]
-A INPUT -i lo -j ACCEPT
-A INPUT -s 24.22.37.138/32 -j ACCEPT
-A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT
-A INPUT -p tcp -m tcp --dport 42422 -j ACCEPT
-A INPUT -s 204.11.192.0/24 -p udp -m udp --dport 5060:5080 -j ACCEPT
-A INPUT -s 204.11.192.0/24 -p udp -m udp --dport 10000:20000 -j ACCEPT
-A INPUT -s 66.193.176.35/32 -p udp -m udp --dport 5060:5080 -j ACCEPT
-A INPUT -s 66.193.176.35/32 -p udp -m udp --dport 10000:20000 -j ACCEPT
-A INPUT -s 66.193.176.54/32 -p udp -m udp --dport 5060:5080 -j ACCEPT
-A INPUT -s 66.193.176.54/32 -p udp -m udp --dport 10000:20000 -j ACCEPT
-A INPUT -s 66.193.176.58/32 -p udp -m udp --dport 5060:5080 -j ACCEPT
-A INPUT -s 66.193.176.58/32 -p udp -m udp --dport 10000:20000 -j ACCEPT
-A INPUT -s 66.54.140.46/32 -p udp -m udp --dport 5060:5080 -j ACCEPT
-A INPUT -s 66.54.140.47/32 -p udp -m udp --dport 5060:5080 -j ACCEPT
-A INPUT -s 66.54.140.46/32 -p udp -m udp --dport 10000:20000 -j ACCEPT
-A INPUT -s 66.54.140.47/32 -p udp -m udp --dport 10000:20000 -j ACCEPT
COMMIT

# how to set up that file

# clear all
iptables -F

# allow localhost
iptables -A INPUT -i lo -j ACCEPT
iptables -A INPUT --src futel2.dyndns.org -j ACCEPT
# allow established connections
iptables -A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT
# let ssh in
iptables -A INPUT -p tcp --dport 42422 -j ACCEPT

# close everything
iptables -P INPUT DROP
iptables -P FORWARD DROP
iptables -P OUTPUT ACCEPT

# callcentric
iptables -A INPUT -p udp -m udp -s 204.11.192.0/24 --dport 5060:5080 -j ACCEPT
iptables -A INPUT -p udp -m udp -s 204.11.192.0/24 --dport 10000:20000 -j ACCEPT
iptables -A INPUT -p udp -m udp -s 66.193.176.35 --dport 5060:5080 -j ACCEPT
iptables -A INPUT -p udp -m udp -s 66.193.176.35 --dport 10000:20000 -j ACCEPT
iptables -A INPUT -p udp -m udp -s 66.193.176.54 --dport 5060:5080 -j ACCEPT
iptables -A INPUT -p udp -m udp -s 66.193.176.54 --dport 10000:20000 -j ACCEPT
iptables -A INPUT -p udp -m udp -s 66.193.176.58 --dport 5060:5080 -j ACCEPT
iptables -A INPUT -p udp -m udp -s 66.193.176.58 --dport 10000:20000 -j ACCEPT
# ipkall
iptables -A INPUT -p udp -m udp -s 66.54.140.46,66.54.140.47 --dport 5060:5080 -j ACCEPT
iptables -A INPUT -p udp -m udp -s 66.54.140.46,66.54.140.47 --dport 10000:20000 -j ACCEPT

# then service iptables save

